// COMPILED TEMPLATES

// Original file: extend.js
//-- http://stackoverflow.com/questions/2124684/jquery-how-click-anywhere-outside-of-the-div-the-div-fades-out
jQuery.fn.extend({clickOutside:function(e,t){var n=this;return jQuery("body").on("click.offer",function(r){if(t&&jQuery.inArray(r.target,t)>-1)return;if(jQuery.contains(n[0],r.target))return;jQuery("body").off("click.offer"),e(r,n)}),this}});
// Original file: mercury.js
var LPL={};LPL.Mercury=function(){function h(e){function s(e){console.log("loaded.loaded()",arguments);var t=LPL.Mercury.MODES[i];a[t]=e,i++,u()}function u(){i==LPL.Mercury.MODES.length&&(o=a.screen,r.blendFilter=o,e())}console.log("loadShaders.loadShaders()",arguments);for(var t=0,n=LPL.Mercury.MODES.length;t<n;t++)J3D.Loader.loadGLSL("shaders/"+LPL.Mercury.MODES[t]+".glsl",s);var i=0}function p(){a.kaleido.controls={create:function(e){r.blendFilter.arg1=c.kaleidoSplit;var t=e.add(c,"kaleidoSplit",2,8);t.step(1),t.onChange(function(){r.blendFilter.arg1=c.kaleidoSplit*.25}),f.push(t)}}}function d(){var e=c.resolution.split("x")[0],t=c.resolution.split("x")[1],n=Math.min(window.innerWidth/e,window.innerHeight/t),r=document.getElementsByTagName("canvas")[0];r.style.width=e*n+"px",r.style.height=t*n+"px",r.style.marginLeft=-e/2*n+"px",r.style.marginTop=-t/2*n+"px"}function v(){l=new dat.GUI,l.remember(c);var e=l.add(c,"resolution",LPL.Mercury.RESOLUTIONS);e.onChange(c.changeResolution);var t=l.add(c,"mode",LPL.Mercury.MODES);t.onChange(c.changeMode);var n=l.add(c,"exposure",1,100);n.onFinishChange(function(){r.blendFilter.exposure=c.exposure*.01});var i=l.add(c,"fps",1,120);i.onFinishChange(function(){c.state!="painting"&&c.new()}),l.add(c,"new"),l.add(c,"start / stop")}var e,t,n,r,i,s,o,u,a={},f=[],l,c=this;this.kaleidoSplit=2,this.state="notPainting",this.exposure=20,this.resolution="1024x768",this.fps=60,this.mode="screen",this.init=function(){function i(i){a.WebcamShader=i,J3D.UserStream(function(o){t=o,s=new J3D.Texture(o),r=new J3D.Persistence(n),r.vTexture=s,r.fboN=new J3D.FrameBuffer,r.fboA=new J3D.FrameBuffer,r.fboB=new J3D.FrameBuffer,v(),h(p),e=new J3D.Postprocess(n),e.filter=i,e.render=function(){J3D.Time.tick(),s.update(),e.renderEffect(s.tex)},u=n.resize,n.resize={},c.changeResolution(c.resolution),c.new()})}console.log("Mercury.init()",arguments),n=new J3D.Engine(undefined,undefined,{preserveDrawingBuffer:!0}),n.setClearColor(J3D.Color.black),J3D.Loader.loadGLSL("shaders/WebcamShader.glsl",i),window.addEventListener("resize",d)},this.changeResolution=function(e){console.log("changeResolution",e);var t=e.split("x")[0],r=e.split("x")[1];n.resize=u,n.resize(t,r),n.resize=function(){},d()},this.start=function(){c.state="painting",r.blendFilter=o,r.blendFilter.exposure=c.exposure*.01,clearTimeout(i),i=setInterval(function(){r.render()},1e3/c.fps)},this.stop=function(){c.state="notPainting",clearTimeout(i)},this["start / stop"]=function(){c.state=="painting"?c.stop():c.start()},this.new=function(){c.stop(),r.fboN=new J3D.FrameBuffer,r.fboA=new J3D.FrameBuffer,r.fboB=new J3D.FrameBuffer,i=setInterval(function(){e.render()},1e3/c.fps)},this.changeMode=function(e){console.log("Mercury.changeMode()",arguments),o=a[e];if(f.length>0){for(var t=0,n=f.length;t<n;t++)l.remove(f[t]);f=[]}o.controls&&o.controls.create(l)}},LPL.Mercury.MODES=["screen","add","overlay","softlight","kaleido","sandbox"],LPL.Mercury.RESOLUTIONS=["320x240","640x480","800x600","1024x768","1280x720"];
// Original file: mercury_old.js
function init(){$window=$(window),J3D.Capabilities.webgl||alert("WebGL isn't supported! Update Chrome to the latest version."),J3D.UserStream(function(e){userStream=e,engine=new J3D.Engine(undefined,undefined,{preserveDrawingBuffer:!0}),resize=engine.resize,engine.setClearColor(J3D.Color.black),post=new J3D.Persistence(engine),post.vTexture=new J3D.Texture(userStream),$window.resize(function(){$canvas=$("#mercury canvas");if($canvas[0]!=undefined){var e=$window.width()/controls.resolution.split("x")[0],t=$window.height()/controls.resolution.split("x")[1],n=Math.min(e,t);$canvas.css("-webkit-transform","scaleX("+ -n+") scaleY("+n+")")}}),createControls(),changeMode(states.webcamPreview)})}function createControls(){var e=function(){this.resolution=resolutions[2],this.exposure=20,this.save=savePainting,this.new=newPainting,this.mode=modes.screen,this["start / stop"]=togglePainting};controls=new e,gui=new dat.GUI,gui.remember(controls);var t=gui.add(controls,"resolution",resolutions);t.onChange(changeResolution);var n=gui.add(controls,"mode",modes);n.onChange(changeCompositor),t.onChange(changeResolution),gui.add(controls,"exposure",0,100),gui.add(controls,"save"),gui.add(controls,"new"),gui.add(controls,"start / stop"),changeCompositor(controls.mode),setTimeout(function(){changeResolution(controls.resolution)},3e3),$(document).on("keydown",function(e){var t=e.keyCode;t==32?togglePainting():t==78?newPainting():t==83&&savePainting()})}function changeCompositor(e){var t=e.split("#");compositor=t[0],shaderArgs=t.splice(1,t.length)}function changeMode(e){console.log("changeMode",e),J3D.Loader.loadGLSL("./shaders/"+e+".glsl",function(e){post.blendFilter=e,post.blendFilter.exposure=controls.exposure/100;for(var t=0;t<shaderArgs.length;t++)post.blendFilter["arg"+(t+1).toString()]=shaderArgs[t];renderFunction=draw,draw()})}function changeResolution(e){console.log("changeResolution",e);var t=e.split("x")[0],n=e.split("x")[1];engine.resize=resize,engine.resize(t,n),engine.resize=function(){},$canvas=$("#mercury canvas"),$canvas.css("margin-left",-t/2+"px"),$canvas.css("margin-top",-n/2+"px"),newPainting(),$window.trigger("resize")}function newPainting(){stopPainting(),state=states.webcamPreview,post.blendFilter.exposure=0,post.fboN=new J3D.FrameBuffer,post.fboA=new J3D.FrameBuffer,post.fboB=new J3D.FrameBuffer,post.render(),post.blendFilter.exposure=controls.exposure/100,changeMode(states.webcamPreview)}function startPainting(){console.log("startPainting"),state=states.painting,changeMode(compositor)}function stopPainting(){console.log("stopPainting"),state==states.painting&&(state=states.stopped),renderFunction=function(){}}function togglePainting(){console.log("togglePainting"),state==states.painting?stopPainting():startPainting()}function draw(){requestAnimationFrame(renderFunction),post.render()}function savePainting(){state==states.painting?(stopPainting(),setTimeout(save,1e3)):save()}function save(){var e=$("canvas")[0],t=e.width,n=e.height,r=new Uint8Array(t*n*4);gl.readPixels(0,0,t,n,gl.RGBA,gl.UNSIGNED_BYTE,r);var i=document.createElement("canvas");i.height=e.height,i.width=e.width;var s=i.getContext("2d"),o=s.getImageData(0,0,e.width,e.height);for(var u=0;u<o.data.length/4;u++)for(var a=0;a<4;a++)o.data[u*4+a]=r[o.data.length-u*4+a-4];s.putImageData(o,0,0),window.open(i.toDataURL(),"LPL Mercury output","width=400, height=300")}window.onload=init;var states={webcamPreview:"webcamPreview",painting:"painting",stopped:"stopped"},state=states.webcamPreview,modes={screen:"screen",add:"add",overlay:"overlay",softlight:"softlight",kaleido2:"kaleido#0.5",kaleido4:"kaleido#1",kaleido6:"kaleido#3",kaleido8:"kaleido#4",sandbox:"sandbox"},compositor=modes.screen,shaderArgs=[],engine,post,userStream,renderFunction={},gui,controls,resize,resolutions=["320x240","640x480","800x600","1024x768","1280x720"],$window,$canvas;
// Original file: PersistenceVideo.js
J3D.Persistence=function(e){this.drawMode=gl.TRIANGLES,this.engine=e,this.blendWithA=!1,this.fboN=new J3D.FrameBuffer,this.fboA=new J3D.FrameBuffer,this.fboB=new J3D.FrameBuffer,this.geometry=J3D.Primitive.FullScreenQuad(),this.blendFilter=null,this.copyFilter=J3D.ShaderUtil.parseGLSL(J3D.ShaderSource.CopyFilter)},J3D.Persistence.prototype.render=function(){var e,t=this.blendWithA?this.fboA:this.fboB,n=this.blendWithA?this.fboB:this.fboA;this.fboN.bind(),e=this.engine.shaderAtlas.getShader(this.copyFilter),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.useProgram(e),J3D.ShaderUtil.setAttributes(e,this.geometry),J3D.ShaderUtil.setTexture(e,0,"uTexture",this.vTexture),this.copyFilter.setup(e);if(this.geometry.renderMode==J3D.RENDER_AS_OPAQUE)gl.disable(gl.BLEND),gl.enable(gl.DEPTH_TEST);else{gl.disable(gl.DEPTH_TEST),gl.enable(gl.BLEND);var r=this.geometry.srcFactor!=null?this.geometry.srcFactor:gl.SRC_ALPHA,i=this.geometry.dstFactor!=null?this.geometry.dstFactor:gl.ONE;gl.blendFunc(r,i)}gl.drawArrays(this.drawMode,0,this.geometry.size),this.fboN.unbind(),n.bind(),e=this.engine.shaderAtlas.getShader(this.blendFilter),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.useProgram(e),J3D.ShaderUtil.setAttributes(e,this.geometry),J3D.ShaderUtil.setTexture(e,0,"uNewTexture",this.fboN.texture),J3D.ShaderUtil.setTexture(e,1,"uOldTexture",t.texture),this.blendFilter.uNewTexture=this.fboN.texture,this.blendFilter.uOldTexture=t.texture,this.blendFilter.setup(e),gl.drawArrays(gl.TRIANGLES,0,this.geometry.size),n.unbind(),e=this.engine.shaderAtlas.getShader(this.copyFilter),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.useProgram(e),J3D.ShaderUtil.setAttributes(e,this.geometry),J3D.ShaderUtil.setTexture(e,0,"uTexture",n.texture),this.copyFilter.setup(e),gl.drawArrays(gl.TRIANGLES,0,this.geometry.size),this.blendWithA=!this.blendWithA};
// Original file: production.js
function debug(e){e?console=consoleHolder:(consoleHolder=console,console={},console.log=function(){})}var consoleHolder=console;debug(!1);
